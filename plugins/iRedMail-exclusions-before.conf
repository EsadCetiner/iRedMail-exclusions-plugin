# Generic rule to disable plugin
SecRule TX:iRedMail-exclusions-plugin "@eq 0" "id:9518001,phase:1,pass,nolog,ctl:ruleRemoveById=9518100-9518999"

SecRuleUpdateTargetById 942450 !REQUEST_COOKIES:roundcube_sessid
SecRuleUpdateTargetById 942450 !REQUEST_COOKIES:roundcube_sessauth
SecRuleUpdateTargetById 932250 !REQUEST_COOKIES:roundcube_sessauth
SecRuleUpdateTargetById 932236 !REQUEST_COOKIES:roundcube_sessauth
SecRuleUpdateTargetById 942450 !REQUEST_COOKIES:iRedAdmin-MYSQL

# iRedAdmin displays domain names inside the request uri, domains most commonly end in .com which triggers 920440.
SecRule REQUEST_FILENAME "@rx ^/iredadmin/.{0,}\.(com|inc)$" \
    "id:9518100,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveById=920440"

# logging into iRedAdmin admin panel
SecRule REQUEST_FILENAME "@streq /iredadmin/login" \
    "id:9518101,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:password"

# When creating a new iRedMail user
SecRule REQUEST_FILENAME "@beginsWith /iredadmin/create/user/" \
    "id:9518102,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932260;ARGS_NAMES:mailQuota,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:mailQuota,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:confirmpw,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newpw"

# When making changes to an existing iRedMail user or Administrator
SecRule REQUEST_FILENAME "@beginsWith /iredadmin/profile/user/general/" \
    "id:9518103,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932260;ARGS_NAMES:mailQuota,\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:mailQuota,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:confirmpw,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newpw"

# When adding a new iRedMail Administrator
SecRule REQUEST_FILENAME "@streq /iredadmin/create/admin" \
    "id:9518104,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:mail,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:confirmpw,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newpw"

# When changing a iRedMail user's password
SecRule REQUEST_FILENAME "@beginsWith /iredadmin/profile/user/password/" \
    "id:9518105,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:confirmpw,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:newpw"

# When enabling/disabing/deleting iRedMail users
SecRule REQUEST_FILENAME "@rx ^/iredadmin/users/.{0,}/page/[0-9]$" \
    "id:9518106,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:mail"

# When enabling/disabing/deleting iRedMail administrators
SecRule REQUEST_FILENAME "@streq /iredadmin/admins" \
    "id:9518107,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932236;ARGS_NAMES:mail"

# Exclusions for Roundcube Webmail, Roundcube does everything under /mail/ so all RoundCube exclusiosn are included here.
SecRule REQUEST_FILENAME "@streq /mail/" \
    "id:9518108,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=920272;REQUEST_BODY,\
    ctl:ruleRemoveTargetById=932236;ARGS:_email,\
    ctl:ruleRemoveTargetById=932250;ARGS:_email,\
    ctl:ruleRemoveTargetById=942131;ARGS:_to,\
    ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:_action,\
    ctl:ruleRemoveTargetById=932250;ARGS:_action,\
    ctl:ruleRemoveTargetById=932236;ARGS:_action,\
    ctl:ruleRemoveTargetById=932131;REQUEST_HEADERS:referer,\
    ctl:ruleRemoveTargetById=932237;REQUEST_HEADERS:referer,\
    ctl:ruleRemoveTargetById=932236;REQUEST_HEADERS:referer,\
    ctl:ruleRemoveTargetById=932236;ARGS:_action_notifymethod[0],\
    ctl:ruleRemoveTargetById=932200;ARGS:_action_notifymethod[0],\
    ctl:ruleRemoveTargetById=932131;ARGS:_action_notifymethod[0],\
    ctl:ruleRemoveTargetById=932236;ARGS:_action_notifymethod[1],\
    ctl:ruleRemoveTargetById=932200;ARGS:_action_notifymethod[1],\
    ctl:ruleRemoveTargetById=932131;ARGS:_action_notifymethod[1],\
    ctl:ruleRemoveTargetById=942131;ARGS:r[0],\
    ctl:ruleRemoveTargetById=932160;ARGS:r[0],\
    ctl:ruleRemoveTargetById=932236;ARGS:_section,\
    ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:_framed,\
    ctl:ruleRemoveTargetById=921180;TX:paramcounter_ARGS_NAMES:_task,\
    ctl:ruleRemoveTargetById=932236;ARGS:_task,\
    ctl:ruleRemoveTargetById=931130;ARGS:_website[],\
    ctl:ruleRemoveTargetById=931130;ARGS:_search_website,\
    ctl:ruleRemoveTargetById=931130;ARGS:_im[],\
    ctl:ruleRemoveTargetById=931130;ARGS:_search_im,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_signature,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_confpasswd,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_newpasswd,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_curpasswd,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_pass,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_message,\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_rule_target[0][],\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:_custom_var[0][],\
    ctl:ruleRemoveTargetByTag=OWASP_CRS;ARGS:rawsetcontent,\
    ctl:ruleRemoveById=953100"
    
# If roundcube webmail sets a funny referrer then favicon will not load
SecRule REQUEST_FILENAME "@streq /favicon.ico" \
    "id:9518109,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'iRedMail-exclusions-plugin/1.0.0',\
    ctl:ruleRemoveTargetById=932131;REQUEST_HEADERS:referer,\
    ctl:ruleRemoveTargetById=932237;REQUEST_HEADERS:referer,\
    ctl:ruleRemoveTargetById=932236;REQUEST_HEADERS:referer"
